程序管控维护箱包装的与基本单位数量关系必须与最大箱包数一致

1.历程纪要
 {{{
> 隐藏最大箱包数字段，若维护商品包装时，当“包装形态”=箱包时，最大箱包数默认等于“基本单位数量关系”不允许修改；

> 当“包装形态”=单品时，与基本单位数量关系只能是1；

> 若商品没有箱包信息时，最大箱包数字段的值默认等于商品的最小要货量

> 保存和提交、批量导入、批量修改时完善校验；

> 20210510与刘玉光和张荣华沟通，
}}}
2.需求描述
 {{{
> SAP主数据组同事沟通，要求管控新品创建时的箱包单位的“与基本单位数量关系”必须和主数据中的“最大箱包数”一致；

> 程序管控单品包装的“与基本单位数量关系”只能维护1；
}}}
3.设计原则

 * 供应商端逻辑调整
 {{{
> 供应商在【新品列表】点击“新增”按钮创建新品时，取消【新增商品】详情界面中的“最大箱包数”字段的前端界面展示，后台保留该字段，允许为空（注意查看时该字段保留）；

> 供应商在【新品列表】点击“编辑”按钮修改新品信息时，“最大箱包数”字段的前端界面展示修改为仅展示，不允许修改；

> 供应商在【新品列表】点击“批量导入”按钮批量新增新品信息时，取消“最大箱包数”字段的维护，后台数据库中允许该字段为空，调整后的模板见附件《供应商新品导入模板.xlsx》（最大箱包数在储藏状态字段前面）；

> 修改供应商端批量导入模板，取消单品包装中的“与基本单位数量关系（单品）”字段的取值字段的维护，导入时默认等于1，模板详见附件《供应商新品导入模板.xlsx》（与基本单位数量关系（单品）在包装长(cm)（单品）的前面）；
}}}

 * 采购商端逻辑调整：
 {{{
> 采购文员在【新品列表】点击“新增”按钮创建新品时，取消【新增商品】详情界面中的“最大箱包数”字段的前端界面展示，后台保留该字段，点击右上角的“保存”或“提交”按钮时，将“最大箱包数”写入后台数据库对应字段，取值逻辑如下：

    >> 如果当前商品有箱包，则系统校验商品包装中维护的箱包的“与基本单位数量关系”必须是最小要货量的整数倍，否则提示：‘商品名称’的箱包数不是最小要货量的整数倍，请处理；

    >> 若当前新增的商品是新品，即当前主条形码在【新品列表】和【商品列表】中不存在：
        >>> 若当前商品有箱包记录，则“最大箱包数”默认等于【商品包装】中“包装形态”=箱包的“与基本单位数量关系”字段值；
        >>> 若当前商品没有箱包记录，则“最大箱包数”默认等于“最小要货量”；

    >> 若当前新增的商品是老品，即当前主条形码在【商品列表】中存在source=SAP的记录，则“最大箱包数”取【商品列表】（material_center__material）中source=SAP的记录对应的“最大箱包数”字段值；

    >> 若当前新增的商品是老品，即当前主条形码在【新品列表】中不存在source=SAP，但存在source=New_item的记录，且“审核状态”是待质检、待税审、质检不通过、待商品部审核、审核成功、发布成功，则“最大箱包数”取【新品列表】（material_center__material）中source=New_item的记录对应的“最大箱包数”字段值；

    >> 若【商品包装】中维护的“包装单位”=单品，则对应的“与基本单位数量关系”只能维护1，否则点击右下角的“保存”和“保存并添加商品”和点击右上角的“保存”、“提交”按钮程序报错：‘商品名称’的单品的与基本单位数量关系只能维护1（此处的商品名称取实际的商品名称）；
}}}
 {{{
> 采购文员在【新品列表】点击“批量导入”按钮创建新品时，增加程序逻辑管控：

    >> 修改采购商端批量导入模板，取消箱包中的“最大箱包数”字段的维护，导入时该字段允许为空，点击【批量导入创建新品】界面的“提交”按钮后，增加“最大箱包数”的取值逻辑：模板详见附件《采购商新品导入模板.xlsx》（最大箱包数在最小要货量字段前面）：

        >>> 如果当前商品有箱包，则系统校验商品包装中维护的箱包的“与基本单位数量关系（箱包）”必须是最小要货量的整数倍，否则提示：‘商品名称’的箱包数不是最小要货量的整数倍，请处理；

        >>> 若当前新增的商品是新品，即当前主条形码在【新品列表】和【商品列表】中不存在：
            >>>> 若当前商品有箱包记录，则“最大箱包数”默认等于【商品包装】中“包装形态”=箱包的“与基本单位数量关系”字段值；
            >>>> 若当前商品没有箱包记录，则“最大箱包数”默认等于“最小要货量”；

        >>> 若当前新增的商品是老品，即当前主条形码在【商品列表】中存在source=SAP的记录，则“最大箱包数”取【商品列表】（material_center__material）中source=SAP的记录对应的“最大箱包数”字段值；

        >>> 若当前新增的商品是老品，即当前主条形码在【新品列表】中不存在source=SAP的记录，但存在source=New_item的记录，且“审核状态”是待质检、待税审、质检不通过、待商品部审核、审核成功、发布成功，则“最大箱包数”取【新品列表】（material_center__material）中source=New_item的记录对应的“最大箱包数”字段值；

    >> 修改采购商端批量导入模板，取消单品包装中的“与基本单位数量关系（单品）”字段的取值字段的维护，导入时默认等于1，模板详见附件《采购商新品导入模板.xlsx》（与基本单位数量关系（单品）在包装长(cm)（单品）字段前面）；
}}}
 {{{
> 采购文员在【新品列表】点击“详情”按钮进入详情界面“编辑”后点击“保存”按钮时，增加程序逻辑管控：

    >> 如果当前商品是新品且有箱包，则系统校验商品包装中维护的箱包的“与基本单位数量关系（箱包）”必须是最小要货量的整数倍，否则提示：‘商品名称’的“与基本单位数量关系”不是最小要货量的整数倍，请处理；

    >> “最大箱包数”字段修改为仅查看，该字段非必填，编辑后点击“保存”时字段取值逻辑如下：

        >>> 若当前新增的商品是新品，即当前主条形码在【新品列表】和【商品列表】中不存在：
            >>>> 若当前商品有箱包记录，则“最大箱包数”默认等于【商品包装】中“包装形态”=箱包的“与基本单位数量关系”字段值；
            >>>> 若当前商品没有箱包记录，则“最大箱包数”默认等于“最小要货量”；

        >>> 若当前新增的商品是老品，即当前主条形码在【商品列表】中存在source=SAP的记录，则“最大箱包数”取【商品列表】（material_center__material）中source=SAP的记录对应的“最大箱包数”字段值；

        >>> 若当前新增的商品是老品，即当前主条形码在【新品列表】中存在source=New_item的记录，且“审核状态”是待质检、待税审、质检不通过、待商品部审核、审核成功、发布成功，则“最大箱包数”取【新品列表】（material_center__material）中source=New_item的记录对应的“最大箱包数”字段值；

    >> 若【商品包装】中维护的“包装单位”=单品包装，则对应的“与基本单位数量关系”必须等于1，否则点击右上角的“保存”按钮报错：‘商品名称’的单品的与基本单位数量关系只能维护1（此处的商品名称取实际的商品名称）；
}}}
 {{{
> 采购文员在【新品列表】点击“批量完善”按钮补充供应商发起的新品信息时，增加程序逻辑管控：

    >> 修改采购商端批量导出模板，“最大箱包数”字段变为仅展示（即不根据用户导出后编辑的数据修改原有字段值），用户点击【导入采购完善信息】中的“提交”按钮时，增加“最大箱包数”字段的取值逻辑，模板详见附件《采购商端-新品导出模板.xlsx》（最大箱包数在季节性前面）：
        >>> 如果当前商品是新品且有箱包，则系统校验商品包装中维护的箱包的“与基本单位数量关系（箱包）”必须是最小要货量的整数倍，否则提示：第N行商品的“与基本单位数量关系（箱包）不是最小要货量的整数倍，请处理；

        >>> 若当前新增的商品是新品，即当前主条形码在【新品列表】和【商品列表】中不存在：
            >>>> 若当前商品有箱包记录，则“最大箱包数”默认等于【商品包装】中“包装形态”=箱包的“与基本单位数量关系”字段值；
            >>>> 若当前商品没有箱包记录，则“最大箱包数”默认等于“最小要货量”；

        >>> 若当前新增的商品是老品，即当前主条形码在【商品列表】中存在source=SAP的记录，则“最大箱包数”取【商品列表】（material_center__material）中source=SAP的记录对应的“最大箱包数”字段值；

        >>> 若当前新增的商品是老品，即当前主条形码在【新品列表】中存在source=New_item的记录，且“审核状态”是待质检、待税审、质检不通过、待商品部审核、审核成功、发布成功，则“最大箱包数”取【新品列表】（material_center__material）中source=New_item的记录对应的“最大箱包数”字段值；

    >> 修改批量完善模板中的“与基本单位数量关系（单品）”，该字段变为仅展示，即点击批量完善按钮导入时，不根据该字段值更新数据库中对应字段值；
}}}

 * 数据初始化原则
 {{{
> SAP中已存在的商品：建议SAP检查主数据中最大箱包数不正确的商品信息，修改后通过接口下发更新B2B中对应字段值；

> B2B中没有同步SAP的商品：检查有箱包装的商品的与基本单位数量关系是否和“最大箱包数”一致，若不一致，则根据【商品包装】中“包装形态”=XB的“与基本单位数量关系”更新“最大箱包数”字段值；

> 数据初始化处理时，排除审核状态是发布成功和审核作废的；

> 数据提取：一个是最大箱包数不是箱包的与基本单位数量关系倍数的，一个是最大箱包数不是最小要货量倍数的提取出来；
}}}

----
